/*! Firebase.getAsArray - v0.0.1 - 2014-04-14
* Copyright (c) 2014 Kato
* MIT LICENSE */
!function(a){function b(a,b){this.ids=[],this.list=[],this.ref=a,this.eventCallback=b,this._initList(),this._initListeners()}function c(a,b){if(d(a)&&d(b)){var c;for(c in a)a.hasOwnProperty(c)&&!b.hasOwnProperty(c)&&delete a[c];for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}return b}function d(a){return"object"==typeof a&&null!==a}a.getAsArray=function(a,c){return new b(a,c).getList()},b.prototype={getList:function(){return this.list},add:function(a,b){var c=arguments.length>1?b:this.ref.push().name(),d=this.ref.child(c);return d.set(a,this._handleErrors.bind(this,c)),d},set:function(a,b){this.ref.child(a).set(b,this._handleErrors.bind(this,a))},update:function(a,b){this.ref.child(a).update(b,this._handleErrors.bind(this,a))},setPriority:function(a,b){this.ref.child(a).setPriority(b)},remove:function(a){this.ref.child(a).remove(this._handleErrors.bind(null,a))},posByKey:function(a){return this.ids.indexOf(a)},keyForPos:function(a){return this.ids[a]},_serverAdd:function(a,b){this._moveTo(a.name(),a.val(),b),this._handleEvent("child_added",a.name(),a.val())},_serverRemove:function(a){var b=this.posByKey(a.name());-1!==b&&(this.list.splice(b,1),this.ids.splice(b,1),this._handleEvent("child_removed",a.name(),this.list[b]))},_serverChange:function(a){var b=this.posByKey(a.name());-1!==b&&(this.list[b]=c(this.list[b],a.val()),this._handleEvent("child_changed",a.name(),this.list[b]))},_serverMove:function(a,b){var c=a.name(),d=this.posByKey(c);if(-1!==d){var e=this.list[d];this.list.splice(d,1),this.ids.splice(d,1),this._moveTo(c,e,b),this._handleEvent("child_moved",a.name(),e)}},_moveTo:function(a,b,c){if(null===c)this.ids.unshift(a),this.list.unshift(b);else{var d=this.posByKey(a);-1===d?d=this.list.length:d++,this.ids.splice(d,0,a),this.list.splice(d,0,b)}},_handleErrors:function(a,b){b&&(this._handleEvent("error",null,a),console.error(b))},_handleEvent:function(a,b,c){this.eventCallback&&this.eventCallback(a,b,c)},_initList:function(){this.list.$keyFor=this.keyForPos.bind(this),this.list.$indexOf=this.posByKey.bind(this),this.list.$add=this.add.bind(this),this.list.$remove=this.remove.bind(this),this.list.$set=this.set.bind(this),this.list.$update=this.update.bind(this),this.list.$move=this.setPriority.bind(this)},_initListeners:function(){this.ref.on("child_added",this._serverAdd.bind(this)),this.ref.on("child_removed",this._serverRemove.bind(this)),this.ref.on("child_changed",this._serverChange.bind(this)),this.ref.on("child_moved",this._serverMove.bind(this))}}}("undefined"==typeof window?exports:window.Firebase);